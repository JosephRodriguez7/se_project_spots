!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_active"},t=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass)},o=(e,t,o)=>{(e=>e.some(e=>!e.validity.valid))(e)?(t.disabled=!0,t.classList.add(o.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(o.inactiveButtonClass))},r=e=>{const r=document.querySelectorAll(e.formSelector);r.forEach(r=>{((e,r)=>{const n=Array.from(e.querySelectorAll(r.inputSelector)),a=e.querySelector(r.submitButtonSelector);console.log(n),console.log(a),o(n,a,r),n.forEach(l=>{l.addEventListener("input",function(){((e,o,r)=>{console.log(o.validationMessage),o.validity.valid?t(e,o,r):((e,t,o,r)=>{const n=t.id+"-error",a=e.querySelector(`#${t.id}-error`);a.textContent=o,console.log(n),a.classList.add(r.errorClass),t.classList.add(r.inputErrorClass)})(e,o,o.validationMessage,r)})(e,l,r),o(n,a,r)})})})(r,e)}),console.log(r)},n=(e,r)=>{const n=Array.from(e.querySelectorAll(r.inputSelector)),a=e.querySelector(r.submitButtonSelector);n.forEach(o=>{t(e,o,r)}),o(n,a,r)};r(e);const a=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_handleServerResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:{...this._headers}}).then(e=>this._handleServerResponse(e))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:{...this._headers}}).then(e=>this._handleServerResponse(e))}updateUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:{...this._headers},body:JSON.stringify({name:e,about:t})}).then(e=>this._handleServerResponse(e))}updateUserAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:{...this._headers},body:JSON.stringify({avatar:e})}).then(e=>this._handleServerResponse(e))}addCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:{...this._headers},body:JSON.stringify({name:e,link:t})}).then(e=>this._handleServerResponse(e))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:{...this._headers}}).then(e=>this._handleServerResponse(e))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:{...this._headers}}).then(e=>this._handleServerResponse(e))}unlikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:{...this._headers}}).then(e=>this._handleServerResponse(e))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"8cf30273-2dc5-46c8-8e03-23447995aee4","Content-Type":"application/json"}});a.getInitialCards().then(e=>{console.log("Cards received:",e),e.forEach(function(e){const t=j(e);d.append(t)})}),a.getUserInfo().then(e=>{console.log("User info received:",e),f.textContent=e.about,S.textContent=e.name,q.src=e.avatar}).catch(e=>{console.error("Failed to get user info:",e)});const l=document.querySelector("#card-modal"),s=l.querySelector(".modal__close-button_alt"),c=l.querySelector(".modal__card-image"),i=l.querySelector(".modal__card-caption"),d=document.querySelector(".cards__list"),u=document.querySelector("#card-template"),m=document.querySelector("#edit-profile-modal"),_=document.querySelector("#new-post-modal"),h=document.querySelector("#deletion-modal"),v=document.querySelector("#update-avatar-modal"),S=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),y=document.querySelector("#name-input"),p=document.querySelector("#description-input"),b=m.querySelector(".modal__submit-button"),q=document.querySelector(".profile__avatar"),C=document.querySelector("#caption-input"),g=document.querySelector("#image-link-input"),k=_.querySelector(".modal__submit-button"),L=document.querySelector("#editProfileBtn"),E=document.querySelector("#newPostBtn"),U=m.querySelector(".modal__close-button"),x=_.querySelector(".modal__close-button"),$=h.querySelector(".modal__del-button"),A=h.querySelector(".modal__cancel-button"),w=h.querySelector(".modal__close-button"),B=document.querySelector(".profile__avatar-btn"),R=v.querySelector(".modal__close-button"),D=v.querySelector(".modal__submit-button"),P=v.querySelector(".modal__form"),F=v.querySelector(".modal__input");function T(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",J)}function I(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",J)}let N,O;function j(e){const t=u.content.querySelector(".card").cloneNode(!0),o=t.querySelector(".card__caption"),r=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),s=t.querySelector(".card__delete-button");return e.isLiked&&n.classList.add("card__like-button_active"),n.addEventListener("click",function(){n.classList.contains("card__like-button_active")?a.unlikeCard(e._id).then(e=>{console.log("Unliked:",e),n.classList.toggle("card__like-button_active")}).catch(e=>{console.error("Failed to unlike",e)}):a.likeCard(e._id).then(e=>{console.log("Liked:",e),n.classList.toggle("card__like-button_active")}).catch(e=>{console.error("Failed to like",e)})}),s.addEventListener("click",function(){N=t,O=e._id,T(h)}),r.addEventListener("click",function(){c.src=e.link,c.alt=e.name,i.textContent=e.name,T(l)}),r.src=e.link,r.alt=e.name,o.textContent=e.name,t}B.addEventListener("click",function(){T(v)}),R.addEventListener("click",function(){I(v)}),v.addEventListener("submit",function(t){t.preventDefault(),D.textContent="Saving...",console.log(F.value),a.updateUserAvatar({avatar:F.value}).then(e=>{const t=F.value;return q.src=e.avatar,t}).catch(e=>{console.error("Failed to update avatar:",e)}).finally(()=>{I(v),P.reset(),n(P,e),D.textContent="Save"})}),L.addEventListener("click",function(){T(m);const t=m.querySelector(e.formSelector);n(t,e),y.value=S.textContent,p.value=f.textContent}),U.addEventListener("click",function(){I(m),console.log("modalProfileCloseBtn was clicked")}),s.addEventListener("click",function(){I(l),console.log("previewCardCloseBtn was clicked")}),m.addEventListener("submit",function(e){e.preventDefault(),b.textContent="Saving...";const t=y.value,o=p.value;a.updateUserInfo({name:t,about:o}).then(e=>{S.textContent=e.name,f.textContent=e.about,console.log("User info updated:",e)}).catch(e=>{console.error("Failed to update user info:",e)}).finally(()=>{I(m),b.textContent="Save"})}),_.addEventListener("submit",function(t){t.preventDefault(),k.textContent="Saving...",console.log(C.value),console.log(g.value);const r={name:C.value,link:g.value};a.addCard(r).then(r=>{console.log("New card added:",r);const a=j(r);d.prepend(a);const l=t.target,s=l.querySelector(e.submitButtonSelector),c=Array.from(l.querySelectorAll(e.inputSelector));l.reset(),o(c,s,e),n(l,e)}).catch(e=>{console.error("Failed to upload new card:",e)}).finally(()=>{k.textContent="Save",I(_)})}),w.addEventListener("click",function(){I(h)}),A.addEventListener("click",function(){I(h)}),$.addEventListener("click",function(e){e.preventDefault(),$.textContent="Deleting...",a.deleteCard(O).then(()=>{N.remove()}).catch(e=>{console.error("Failed to delete card:",e)}).finally(()=>{I(h),$.textContent="Delete",console.log("Card deleted:",O)})}),E.addEventListener("click",function(){T(_);const t=_.querySelector(e.formSelector);n(t,e)}),x.addEventListener("click",function(){I(_)});const J=e=>{if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&I(e)}},H=e=>{e.target.classList.contains("modal_is-opened")&&I(e.target)};document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("mousedown",H)}),r(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RSxpQkFBaUIsUUFBUyxXQUMxQ3VGLEVBQVd4QixFQUNiLEdBR0EsTUFBTXVCLEVBQWlCbUIsSUFDckIsR0FBZ0IsV0FBWkEsRUFBSWEsSUFBa0IsQ0FDeEIsTUFBTUMsRUFBYy9ILFNBQVNmLGNBQWMsb0JBQ3ZDOEksR0FDRmhDLEVBQVdnQyxFQUVmLEdBSUlDLEVBQTBCZixJQUMxQkEsRUFBSVcsT0FBT3pJLFVBQVV3SCxTQUFTLG9CQUNoQ1osRUFBV2tCLEVBQUlXLFNBS0Q1SCxTQUFTQyxpQkFBaUIsVUFDbENDLFFBQVMyRixJQUNqQkEsRUFBTXJGLGlCQUFpQixZQUFhd0gsS0FHdENsSSxFQUFpQnhCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvbW9kdWxlcy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnV0dG9uX2luYWN0aXZlXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl9hY3RpdmVcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgc2V0dGluZ3MpID0+IHtcbiAgY29uc3QgZXJyb3JNZXNzYWdlSUQgPSBpbnB1dEVsZW1lbnQuaWQgKyBcIi1lcnJvclwiO1xuICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgKTtcbiAgZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgY29uc29sZS5sb2coZXJyb3JNZXNzYWdlSUQpO1xuICBlcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgKTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgY29uc29sZS5sb2coaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihcbiAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxuICAgICAgc2V0dGluZ3NcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKTtcbiAgfVxufTtcblxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICApO1xuXG4gIGNvbnNvbGUubG9nKGlucHV0TGlzdCk7XG4gIGNvbnNvbGUubG9nKGJ1dHRvbkVsZW1lbnQpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChzZXR0aW5ncykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3MuZm9ybVNlbGVjdG9yKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9KTtcbiAgY29uc29sZS5sb2coZm9ybUxpc3QpO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmlucHV0U2VsZWN0b3IpXG4gICk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBzZXR0aW5ncyk7XG4gIH0pO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xufTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICB0b2dnbGVCdXR0b25TdGF0ZSxcbiAgc2V0dGluZ3MsXG59IGZyb20gXCIuLi9zY3JpcHRzL21vZHVsZXMvdmFsaWRhdGlvbi5qc1wiO1xuXG5pbXBvcnQgQXBpIGZyb20gXCIuLi8uLi91dGlscy9BcGkuanNcIjtcblxuLy8gQVBJXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI4Y2YzMDI3My0yZGM1LTQ2YzgtOGUwMy0yMzQ0Nzk5NWFlZTRcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG4vLyBjYWxsaW5nIEFQSSBNZXRob2RzOlxuYXBpLmdldEluaXRpYWxDYXJkcygpLnRoZW4oKGNhcmRzKSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiQ2FyZHMgcmVjZWl2ZWQ6XCIsIGNhcmRzKTtcbiAgY2FyZHMuZm9yRWFjaChmdW5jdGlvbiAoY2FyZCkge1xuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZCk7XG4gICAgY2FyZHNDb250YWluZXIuYXBwZW5kKGNhcmRFbGVtZW50KTtcbiAgfSk7XG59KTtcblxuYXBpXG4gIC5nZXRVc2VySW5mbygpXG4gIC50aGVuKCh1c2VyKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJVc2VyIGluZm8gcmVjZWl2ZWQ6XCIsIHVzZXIpO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gdXNlci5uYW1lO1xuICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gdXNlci5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgdXNlciBpbmZvOlwiLCBlcnIpO1xuICB9KTtcblxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBwcm9maWxlU2F2ZUJ0bi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIGNvbnN0IG5hbWUgPSBwcm9maWxlTmFtZUlucHV0LnZhbHVlO1xuICBjb25zdCBhYm91dCA9IHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlO1xuICBhcGlcbiAgICAudXBkYXRlVXNlckluZm8oeyBuYW1lLCBhYm91dCB9KVxuICAgIC50aGVuKCh1c2VyVXBkYXRlKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gdXNlclVwZGF0ZS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSB1c2VyVXBkYXRlLmFib3V0O1xuICAgICAgY29uc29sZS5sb2coXCJVc2VyIGluZm8gdXBkYXRlZDpcIiwgdXNlclVwZGF0ZSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1cGRhdGUgdXNlciBpbmZvOlwiLCBlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICAgIHByb2ZpbGVTYXZlQnRuLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVBvc3RGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgcG9zdFNhdmVCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBjb25zb2xlLmxvZyhwb3N0Q2FwdGlvbklucHV0LnZhbHVlKTtcbiAgY29uc29sZS5sb2cocG9zdExpbmtJbnB1dC52YWx1ZSk7XG5cbiAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7XG4gICAgbmFtZTogcG9zdENhcHRpb25JbnB1dC52YWx1ZSxcbiAgICBsaW5rOiBwb3N0TGlua0lucHV0LnZhbHVlLFxuICB9O1xuXG4gIGFwaVxuICAgIC5hZGRDYXJkKGlucHV0VmFsdWVzKVxuICAgIC50aGVuKChuZXdDYXJkKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIk5ldyBjYXJkIGFkZGVkOlwiLCBuZXdDYXJkKTtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQobmV3Q2FyZCk7XG4gICAgICBjYXJkc0NvbnRhaW5lci5wcmVwZW5kKGNhcmRFbGVtZW50KTtcblxuICAgICAgY29uc3QgZm9ybSA9IGV2dC50YXJnZXQ7XG4gICAgICBjb25zdCBzdWJtaXRCdG4gPSBmb3JtLnF1ZXJ5U2VsZWN0b3Ioc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICAgICAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICAgICAgZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmlucHV0U2VsZWN0b3IpXG4gICAgICApO1xuICAgICAgZm9ybS5yZXNldCgpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBzdWJtaXRCdG4sIHNldHRpbmdzKTtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbihmb3JtLCBzZXR0aW5ncyk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1cGxvYWQgbmV3IGNhcmQ6XCIsIGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwb3N0U2F2ZUJ0bi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgICAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xuICAgIH0pO1xufVxuXG4vL2NhcmRzIGFycmF5IChQUkFDVElDRSwgbm93IGNvbW1lbnRlZClcbi8qXG5jb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIkdvbGRlbiBHYXRlIEJyaWRnZVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy83LXBob3RvLWJ5LWdyaWZmaW4td29vbGRyaWRnZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcblxuICB7XG4gICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcblxuICB7XG4gICAgbmFtZTogXCJSZXN0YXVyYW50IHRlcnJhY2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMi1waG90by1ieS1jZWlsaW5lLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuXG4gIHtcbiAgICBuYW1lOiBcIkFuIG91dGRvb3IgY2FmZVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8zLXBob3RvLWJ5LXR1YmFudXItZG9nYW4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG5cbiAge1xuICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLCBvdmVyIHRoZSBmb3Jlc3QgYW5kIHRocm91Z2ggdGhlIHRyZWVzXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuXG4gIHtcbiAgICBuYW1lOiBcIlR1bm5lbCB3aXRoIG1vcm5pbmcgbGlnaHRcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNS1waG90by1ieS12YW4tYW5oLW5ndXllbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcblxuICB7XG4gICAgbmFtZTogXCJNb3VudGFpbiBob3VzZVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy82LXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbl07XG4qL1xuXG4vL21vZGFsIGNhcmQgc2VsZWN0b3JzXG5jb25zdCBwcmV2aWV3Q2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLW1vZGFsXCIpO1xuY29uc3QgcHJldmlld0NhcmRDbG9zZUJ0biA9IHByZXZpZXdDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvbl9hbHRcIlxuKTtcbmNvbnN0IHByZXZpZXdDYXJkSW1hZ2VFbCA9IHByZXZpZXdDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FyZC1pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdDYXJkQ2FwdGlvbkVsID0gcHJldmlld0NhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2FyZC1jYXB0aW9uXCJcbik7XG5cbi8vY2FyZCBzZWxlY3RvcnNcbmNvbnN0IGNhcmRzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcblxuLy9tb2RhbCBzZWxlY3RvcnNcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBjb25maXJtRGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0aW9uLW1vZGFsXCIpO1xuY29uc3QgZWRpdEF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN1cGRhdGUtYXZhdGFyLW1vZGFsXCIpO1xuXG4vL3Byb2ZpbGUgdmFyaWFibGVzXG5jb25zdCBwcm9maWxlTmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190aXRsZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWUtaW5wdXRcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVzY3JpcHRpb24taW5wdXRcIik7XG5jb25zdCBwcm9maWxlU2F2ZUJ0biA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuLy9uZXcgcG9zdCBtb2RhbFxuY29uc3QgcG9zdENhcHRpb25JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FwdGlvbi1pbnB1dFwiKTtcbmNvbnN0IHBvc3RMaW5rSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2ltYWdlLWxpbmstaW5wdXRcIik7XG5jb25zdCBwb3N0U2F2ZUJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpO1xuXG4vL29wZW4gYnV0dG9uIHNlbGVjdG9yc1xuY29uc3QgZWRpdFByb2ZpbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXRQcm9maWxlQnRuXCIpO1xuY29uc3QgbmV3UG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3UG9zdEJ0blwiKTtcblxuLy9jbG9zZSBidXR0b25zXG5jb25zdCBtb2RhbFByb2ZpbGVDbG9zZUJ0biA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXG4pO1xuY29uc3QgbW9kYWxQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIpO1xuXG4vL2RlbGV0aW9uIG1vZGFsIGJ1dHRvbnNcbmNvbnN0IGNvbmZpcm1EZWxldGVCdG4gPSBjb25maXJtRGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZGVsLWJ1dHRvblwiKTtcbmNvbnN0IGNhbmNlbERlbGV0ZUJ0biA9IGNvbmZpcm1EZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2FuY2VsLWJ1dHRvblwiXG4pO1xuY29uc3QgZGVsZXRlTW9kYWxDbG9zZUJ0biA9IGNvbmZpcm1EZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCJcbik7XG5cbi8vZWRpdCBhdmF0YXJcbmNvbnN0IGVkaXRBdmF0YXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XG5jb25zdCBlZGl0QXZhdGFyQ2xvc2VCdG4gPSBlZGl0QXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXG4pO1xuY29uc3Qgc2F2ZUF2YXRhckJ0biA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpO1xuY29uc3QgYXZhdGFyTW9kYWxGb3JtID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBhdmF0YXJNb2RhbElucHV0ID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2lucHV0XCIpO1xuXG5lZGl0QXZhdGFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xufSk7XG5lZGl0QXZhdGFyQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xufSk7XG5cbmVkaXRBdmF0YXJNb2RhbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbi8vZWRpdCBwcm9maWxlIGV2ZW50c1xuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuXG4gIGNvbnN0IGZvcm0gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3Ioc2V0dGluZ3MuZm9ybVNlbGVjdG9yKTtcbiAgcmVzZXRWYWxpZGF0aW9uKGZvcm0sIHNldHRpbmdzKTtcbiAgcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQ7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQ7XG59KTtcblxubW9kYWxQcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgY29uc29sZS5sb2coXCJtb2RhbFByb2ZpbGVDbG9zZUJ0biB3YXMgY2xpY2tlZFwiKTtcbn0pO1xuXG5wcmV2aWV3Q2FyZENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwocHJldmlld0NhcmRNb2RhbCk7XG4gIGNvbnNvbGUubG9nKFwicHJldmlld0NhcmRDbG9zZUJ0biB3YXMgY2xpY2tlZFwiKTtcbn0pO1xuXG4vL1N3aXRjaCBidXR0b24gdGV4dCBjb250ZW50cyBmdW5jdGlvbiAoRVhQRVJJTUVOVEFMKVxuZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcbiAgYnRuLFxuICBpc0xvYWRpbmcsXG4gIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxuKSB7XG4gIGlmIChpc0xvYWRpbmcpIHtcbiAgICBidG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgfSBlbHNlIHtcbiAgICBidG4udGV4dENvbnRlbnQgPSBkZWZhdWx0VGV4dDtcbiAgfVxufVxuXG4vL29wZW4gJiBjbG9zZSBtb2RhbCBmdW5jdGlvbnM6IFNUQVJUXG4vL29wZW4gbW9kYWwgZnVuY3Rpb25cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFc2MpO1xufVxuXG4vLyBjbG9zZSBtb2RhbCBmdW5jdGlvblxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFc2MpO1xufVxuLy9vcGVuICYgY2xvc2UgbW9kYWwgZnVuY3Rpb25zOiBFTkRcblxuZWRpdFByb2ZpbGVNb2RhbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcblxubmV3UG9zdE1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUG9zdEZvcm1TdWJtaXQpO1xuLy8gZW5kIG9mIGZ1bmN0aW9uLy9cblxuLy8gQ2FyZCBEZWxldGUgZXZlbnQgbGlzdGVuZXJzOlxuZGVsZXRlTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGNvbmZpcm1EZWxldGVNb2RhbCk7XG59KTtcbmNhbmNlbERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGNvbmZpcm1EZWxldGVNb2RhbCk7XG59KTtcblxuLy9jYXJkIHNlbGVjdGlvbiB2YXJpYWJsZXM6XG5sZXQgc2VsZWN0ZWRDYXJkO1xubGV0IHNlbGVjdGVkQ2FyZElkO1xuXG4vL2dldCBjYXJkIGVsZW1lbnQgZnVuY3Rpb246XG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICBjb25zdCBjYXJkQ2FwdGlvbkVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2NhcHRpb25cIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gIGNvbnN0IGNhcmREZWxCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG5cbiAgLy9MaWtlIEJ1dHRvblxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgfVxuXG4gIGNhcmRMaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgaXNMaWtlZCA9IGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICBpZiAoIWlzTGlrZWQpIHtcbiAgICAgIGFwaVxuICAgICAgICAubGlrZUNhcmQoZGF0YS5faWQpXG4gICAgICAgIC50aGVuKChjYXJkTGlrZWQpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkxpa2VkOlwiLCBjYXJkTGlrZWQpO1xuICAgICAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsaWtlXCIsIGVycik7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcGlcbiAgICAgICAgLnVubGlrZUNhcmQoZGF0YS5faWQpXG4gICAgICAgIC50aGVuKChjYXJkVW5saWtlZCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5saWtlZDpcIiwgY2FyZFVubGlrZWQpO1xuICAgICAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1bmxpa2VcIiwgZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvL0RlbGV0ZSBidXR0b25cbiAgY2FyZERlbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICAgIHNlbGVjdGVkQ2FyZElkID0gZGF0YS5faWQ7XG4gICAgb3Blbk1vZGFsKGNvbmZpcm1EZWxldGVNb2RhbCk7XG4gIH0pO1xuXG4gIC8vQ2FyZCBwcmV2aWV3XG4gIGNhcmRJbWFnZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBwcmV2aWV3Q2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdDYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0NhcmRDYXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdDYXJkTW9kYWwpO1xuICB9KTtcblxuICAvL1BvcHVsYXRlIGNhcmRcbiAgY2FyZEltYWdlRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsZW1lbnQuYWx0ID0gZGF0YS5uYW1lO1xuICBjYXJkQ2FwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufSAvL2VuZCBvZiBnZXQgY2FyZCBlbGVtZW50IGZ1bmN0aW9uXG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIHNhdmVBdmF0YXJCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBjb25zb2xlLmxvZyhhdmF0YXJNb2RhbElucHV0LnZhbHVlKTtcbiAgYXBpXG4gICAgLnVwZGF0ZVVzZXJBdmF0YXIoeyBhdmF0YXI6IGF2YXRhck1vZGFsSW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigodXBkYXRlZEF2YXRhcikgPT4ge1xuICAgICAgY29uc3QgYXZhdGFyID0gYXZhdGFyTW9kYWxJbnB1dC52YWx1ZTtcbiAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gdXBkYXRlZEF2YXRhci5hdmF0YXI7XG4gICAgICByZXR1cm4gYXZhdGFyO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdXBkYXRlIGF2YXRhcjpcIiwgZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdEF2YXRhck1vZGFsKTtcbiAgICAgIGF2YXRhck1vZGFsRm9ybS5yZXNldCgpO1xuICAgICAgcmVzZXRWYWxpZGF0aW9uKGF2YXRhck1vZGFsRm9ybSwgc2V0dGluZ3MpO1xuICAgICAgc2F2ZUF2YXRhckJ0bi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25maXJtRGVsZXRlQnRuLnRleHRDb250ZW50ID0gXCJEZWxldGluZy4uLlwiO1xuXG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGRlbGV0ZSBjYXJkOlwiLCBlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgY2xvc2VNb2RhbChjb25maXJtRGVsZXRlTW9kYWwpO1xuICAgICAgY29uZmlybURlbGV0ZUJ0bi50ZXh0Q29udGVudCA9IFwiRGVsZXRlXCI7XG4gICAgICBjb25zb2xlLmxvZyhcIkNhcmQgZGVsZXRlZDpcIiwgc2VsZWN0ZWRDYXJkSWQpO1xuICAgIH0pO1xufVxuXG4vLyBDb25maXJtIERlbGV0ZSBCdXR0b24gdHJpZ2dlclxuY29uZmlybURlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcblxuLy9uZXcgcG9zdCBldmVudHNcbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XG5cbiAgY29uc3QgZm9ybSA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKHNldHRpbmdzLmZvcm1TZWxlY3Rvcik7XG4gIHJlc2V0VmFsaWRhdGlvbihmb3JtLCBzZXR0aW5ncyk7XG59KTtcblxubW9kYWxQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbi8vIGNsb3NpbmcgbW9kYWxzIHcvIGVzYyBrZXlcbmNvbnN0IGNsb3NlTW9kYWxFc2MgPSAoZXZ0KSA9PiB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICAgIH1cbiAgfVxufTtcblxuLy8gY2xvc2luZyBtb2RhbHMgYnkgY2xpY2tpbmcgb3ZlcmxheVxuY29uc3QgY2xvc2VNb2RhbE92ZXJsYXlDbGljayA9IChldnQpID0+IHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfaXMtb3BlbmVkXCIpKSB7XG4gICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbiAgfVxufTtcblxuLy8gYWxsTW9kYWxzIHNlbGVjdG9yXG5jb25zdCBhbGxNb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuYWxsTW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgY2xvc2VNb2RhbE92ZXJsYXlDbGljayk7XG59KTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB7IC4uLnRoaXMuX2hlYWRlcnMgfSxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcykpO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHsgLi4udGhpcy5faGVhZGVycyB9LFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKSk7XG4gIH1cblxuICB1cGRhdGVVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHsgLi4udGhpcy5faGVhZGVycyB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcykpO1xuICB9XG5cbiAgdXBkYXRlVXNlckF2YXRhcih7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogeyAuLi50aGlzLl9oZWFkZXJzIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhciB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcykpO1xuICB9XG5cbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7IC4uLnRoaXMuX2hlYWRlcnMgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcykpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogeyAuLi50aGlzLl9oZWFkZXJzIH0sXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZShyZXMpKTtcbiAgfVxuXG4gIC8vIGxpa2VDYXJkVG9nZ2xlKGNhcmRJZCwgaXNMaWtlZCkge1xuICAvLyAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gIC8vICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgLy8gICAgIGhlYWRlcnM6IHsgLi4udGhpcy5faGVhZGVycyB9LFxuICAvLyAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKSk7XG4gIC8vIH1cblxuICBsaWtlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogeyAuLi50aGlzLl9oZWFkZXJzIH0sXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZShyZXMpKTtcbiAgfVxuXG4gIHVubGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHsgLi4udGhpcy5faGVhZGVycyB9LFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZWQiLCJhZGQiLCJlbmFibGVWYWxpZGF0aW9uIiwiZm9ybUxpc3QiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJjb25zb2xlIiwibG9nIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkYXRpb25NZXNzYWdlIiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJlcnJvck1lc3NhZ2VJRCIsInRleHRDb250ZW50IiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfaGFuZGxlU2VydmVyUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJnZXRJbml0aWFsQ2FyZHMiLCJ1cGRhdGVVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwidXBkYXRlVXNlckF2YXRhciIsImF2YXRhciIsImFkZENhcmQiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImxpa2VDYXJkIiwidW5saWtlQ2FyZCIsImF1dGhvcml6YXRpb24iLCJjYXJkcyIsImNhcmQiLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwiY2FyZHNDb250YWluZXIiLCJhcHBlbmQiLCJ1c2VyIiwicHJvZmlsZURlc2NyaXB0aW9uRWwiLCJwcm9maWxlTmFtZUVsIiwicHJvZmlsZUF2YXRhciIsInNyYyIsImNhdGNoIiwiZXJyIiwiZXJyb3IiLCJwcmV2aWV3Q2FyZE1vZGFsIiwicHJldmlld0NhcmRDbG9zZUJ0biIsInByZXZpZXdDYXJkSW1hZ2VFbCIsInByZXZpZXdDYXJkQ2FwdGlvbkVsIiwiY2FyZFRlbXBsYXRlIiwiZWRpdFByb2ZpbGVNb2RhbCIsIm5ld1Bvc3RNb2RhbCIsImNvbmZpcm1EZWxldGVNb2RhbCIsImVkaXRBdmF0YXJNb2RhbCIsInByb2ZpbGVOYW1lSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsInByb2ZpbGVTYXZlQnRuIiwicG9zdENhcHRpb25JbnB1dCIsInBvc3RMaW5rSW5wdXQiLCJwb3N0U2F2ZUJ0biIsImVkaXRQcm9maWxlQnRuIiwibmV3UG9zdEJ0biIsIm1vZGFsUHJvZmlsZUNsb3NlQnRuIiwibW9kYWxQb3N0Q2xvc2VCdG4iLCJjb25maXJtRGVsZXRlQnRuIiwiY2FuY2VsRGVsZXRlQnRuIiwiZGVsZXRlTW9kYWxDbG9zZUJ0biIsImVkaXRBdmF0YXJCdG4iLCJlZGl0QXZhdGFyQ2xvc2VCdG4iLCJzYXZlQXZhdGFyQnRuIiwiYXZhdGFyTW9kYWxGb3JtIiwiYXZhdGFyTW9kYWxJbnB1dCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiY2xvc2VNb2RhbEVzYyIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJkYXRhIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRDYXB0aW9uRWxlbWVudCIsImNhcmRJbWFnZUVsZW1lbnQiLCJjYXJkTGlrZUJ0biIsImNhcmREZWxCdG4iLCJpc0xpa2VkIiwiY29udGFpbnMiLCJfaWQiLCJjYXJkVW5saWtlZCIsInRvZ2dsZSIsImNhcmRMaWtlZCIsImFsdCIsImV2dCIsInByZXZlbnREZWZhdWx0IiwidmFsdWUiLCJ1cGRhdGVkQXZhdGFyIiwiZmluYWxseSIsInJlc2V0IiwiZm9ybSIsInVzZXJVcGRhdGUiLCJpbnB1dFZhbHVlcyIsIm5ld0NhcmQiLCJwcmVwZW5kIiwidGFyZ2V0Iiwic3VibWl0QnRuIiwia2V5Iiwib3BlbmVkTW9kYWwiLCJjbG9zZU1vZGFsT3ZlcmxheUNsaWNrIl0sInNvdXJjZVJvb3QiOiIifQ==